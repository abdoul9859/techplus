<!DOCTYPE html>
<html lang="fr" style="margin:0;padding:0;width:100%;height:100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon de Livraison {{ (note.number if note else '') }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root { --primary-color:#045651; --secondary-color:#045651; --text-primary:#111827; --text-secondary:#6b7280; --border-color:#e5e7eb; --bg-light:#eef6f5; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { margin: 0 !important; padding: 0 !important; width: 100% !important; min-height: 100vh !important; background-color: #f5f5f5; }
        body { font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height:1.6; font-size:11pt; color:var(--text-primary); display:flex; flex-direction:column; align-items:center; }

        .page-controls { position: fixed; top: 20px; left: 0; right: 0; display: flex; justify-content: center; gap: 10px; z-index: 1000; }
        .page-controls .btn { padding: 8px 16px; border-radius: 4px; font-weight: 600; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.15); display:flex; align-items:center; gap:8px; }
        .btn-print { background-color: var(--primary-color); color:#fff; border:none; }
        .btn-return { background-color: var(--secondary-color); color:#fff; border:none; }

        .page-container { display:flex; justify-content:center; align-items:center; padding:80px 0 0; min-height:100vh; width:100%; box-sizing:border-box; }
        @media print { 
            html, body { width:210mm; height:auto; margin:0 !important; padding:0 !important; overflow:visible; }
            .page-container { padding:0 !important; margin:0 !important; width:210mm; height:auto; }
            #delivery-container { margin:0 !important; padding:0 !important; border:none !important; box-shadow:none !important; width:210mm !important; height:auto !important; transform:none !important; min-height:297mm !important; }
            .no-print { display:none !important; }
            @page { size:A4; margin:0; }
            .products { 
                page-break-inside: auto; 
                margin-top: 0 !important;
                padding-top: 0 !important;
            }
            .product-row { 
                page-break-inside: avoid; 
                break-inside: avoid; 
            }
            .footer { position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important; width:210mm !important; height:20mm !important; background: var(--bg-light) !important; border-top:2px solid var(--primary-color) !important; padding:12px 28px !important; font-size:10px !important; z-index:1000 !important; page-break-inside:avoid !important; break-inside:avoid !important; margin:0 !important; box-sizing:border-box !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .footer-content { display:grid !important; grid-template-columns: repeat(4,1fr) !important; gap:16px !important; align-items:center !important; height:100% !important; padding:0 !important; }
            .footer-section h4 { font-size:10px !important; font-weight:600 !important; color:#333 !important; margin:0 0 3px 0 !important; text-transform:uppercase !important; }
            .footer-section p { margin:0 !important; color:#666 !important; font-size:9px !important; line-height:1.3 !important; }
        }

        .container-a4 { width:210mm !important; max-width:210mm !important; min-height:297mm !important; margin:0 !important; padding:0 !important; background:#fff !important; box-shadow:0 5px 15px rgba(0,0,0,0.08); overflow:visible; display:flex; flex-direction:column; position:relative; }
        .header { background:linear-gradient(180deg, rgba(4,86,81,0.06), #ffffff 60%); padding:20px 24px 8px; border-bottom:1px solid #e0e0e0; display:flex; justify-content:space-between; align-items:flex-start; }
        .logo { max-width:150px; max-height:150px; object-fit:contain; }
        .company-info { padding-top: 20px; }
        .company-info h1 { font-size:22px; font-weight:800; margin:0; color:var(--primary-color); }
        .company-info p { margin:2px 0; font-size:11px; color:var(--text-secondary); }
        .delivery-info {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            padding-top: 8px;
        }
        .delivery-title { font-size:14px; font-weight:700; color:var(--secondary-color); margin:0 0 4px 0; text-transform:uppercase; letter-spacing:.6px; }
        .delivery-number { display:inline-block; font-size:13px; font-weight:700; color:var(--primary-color); background:var(--bg-light); border:1px solid var(--primary-color); padding:4px 12px; border-radius:9999px; margin:0 0 4px 0; }
        .delivery-date { font-size:12px; color:var(--text-secondary); margin:0; }

        .billing { display:flex; padding:16px 24px; gap:24px; background-color:#fff; border-bottom:1px solid var(--border-color); margin:0 20px; }
        .section-title { font-size:11px; font-weight:700; text-transform:uppercase; color:var(--text-secondary); margin-bottom:8px; letter-spacing:.5px; border-bottom:2px solid #3498db; padding-bottom:6px; display:inline-block; }
        .client-details p { margin:4px 0; font-size:13px; color:var(--text-primary); }
        .delivery-box { background:var(--bg-light); padding:16px; border-radius:6px; border:1px solid var(--border-color); }

        .products { flex:1; display:flex; flex-direction:column; width:calc(100% - 60px); margin:16px 30px 0; background:#fff; border:1px solid var(--border-color); border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.04); }
        .products-header { display:flex; background:var(--bg-light); padding:12px 16px; font-size:12px; font-weight:700; color:var(--text-primary); text-transform:uppercase; border-bottom:2px solid var(--primary-color); }
        .product-col{flex:3;text-align:left}
        .qty-col{flex:1;text-align:right}
        .product-row { display:flex; padding:12px 16px; border-bottom:1px dashed var(--border-color); }
        .product-row:nth-child(even){ background:rgba(4,86,81,0.03); }
        .product-name { flex:3; font-weight:500; font-size:13px; color:var(--text-primary); padding-right:12px; }
        .product-desc { color:#555; font-size:11px; text-align:justify; }
        .product-qty { flex:1; text-align:right; font-size:13px; font-weight:500; color:var(--text-secondary); }

        .footer{padding:16px 32px;border-top:2px solid var(--primary-color);font-size:11px;width:100%;margin-top:auto;background:var(--bg-light);-webkit-print-color-adjust:exact;print-color-adjust:exact}
        .footer-content{display:grid;grid-template-columns:repeat(4,1fr);align-items:start;gap:24px;max-width:100%;margin:0 auto}
        .footer-section{padding:0 12px;border-left:1px solid var(--border-color)}
        .footer-section:first-child{border-left:none;padding-left:0}
        .footer-section h4{font-size:11px;font-weight:700;color:var(--accent-color);margin:0 0 6px 0;text-transform:uppercase;letter-spacing:.6px}
        .footer-section p{margin:4px 0;color:var(--text-secondary);font-size:11px;line-height:1.5}
        .footer-section i{display:inline-flex;align-items:center;justify-content:center;color:#fff;background:var(--primary-color);margin-right:8px;font-size:10px;width:18px;height:18px;border-radius:50%;text-align:center}
        
        /* Footer fixe pour l'impression */
        @media print {
            .footer-content { 
                display: flex !important; 
                justify-content: space-between !important; 
                gap: 15px !important; 
                align-items: center !important;
                height: 100% !important;
                padding: 0 !important;
            }
            .footer-section { 
                text-align: center !important; 
                flex: 1 !important; 
            }
            .footer-section h4 { 
                font-size: 10px !important; 
                font-weight: 600 !important; 
                color: #333 !important; 
                margin: 0 0 3px 0 !important; 
                text-transform: uppercase !important; 
            }
            .footer-section p { 
                margin: 0 !important; 
                color: #666 !important; 
                font-size: 9px !important; 
                line-height: 1.3 !important;
            }
        }

        .delivery-notes { 
            margin: 12px 30px 16px auto; 
            max-width: 60%; 
            background: #f9fafb; 
            border: 1px solid #e5e7eb; 
            border-radius: 6px; 
            padding: 12px 14px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        }
        .delivery-notes h4 { 
            font-size: 12px; 
            margin: 0 0 6px 0; 
            text-transform: uppercase; 
            color: #374151; 
            text-align: right;
            letter-spacing: .3px;
        }
        .delivery-notes ul { margin: 0; padding-left: 18px; }
        .delivery-notes li { font-size: 11px; color: #4b5563; margin: 2px 0; }
        .delivery-notes .meta { font-size: 11px; color: #6b7280; text-align: right; margin-top: 4px; }
    </style>
</head>
<body>
    <div class="page-controls no-print">
        <button id="printBtn" class="btn btn-print"><i class="fas fa-print"></i> Imprimer</button>
        <button id="returnBtn" class="btn btn-return"><i class="fas fa-arrow-left"></i> Retour</button>
    </div>

    <div class="page-container">
        <div id="delivery-container" class="container-a4">
            <div class="header">
                <div style="display:flex; gap:16px; align-items:flex-start;">
                    {% if settings.logo %}<img src="{{ settings.logo }}" class="logo" alt="Logo">{% endif %}
                    <div class="company-info">
                        <h1>{{ settings.company_name or 'Ma Boutique' }}</h1>
                        <p>{{ settings.address or '' }}</p>
                        <p>{{ settings.phone or '' }} {% if settings.email %}· {{ settings.email }}{% endif %}</p>
                    </div>
                </div>
                <div class="delivery-info">
                    <h2 class="delivery-title">BON DE LIVRAISON</h2>
                    <p class="delivery-number">#{{ (note['number'] if note else '') }}</p>
                    <p class="delivery-date">Date: {{ (note['delivery_date'] if note else '') }}</p>
                </div>
            </div>

            <!-- Compact header (2 lines) -->
            <div style="margin:10px 24px 0; background:#fff; border:1px solid #e5e7eb; border-radius:6px; padding:10px 12px;">
                <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; font-size:13px;">
                    <div><strong>Client:</strong> {{ (note['client_name'] if note else '') }}</div>
                    {% if note and note['notes'] %}
                        <div class="text-muted" style="font-size:12px">— {{ note['notes'] }}</div>
                    {% endif %}
                </div>
                <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap; margin-top:6px; font-size:12.5px; color:#374151;">
                    <div><strong>Adresse:</strong> {{ (note['delivery_address'] if note and note['delivery_address'] else '—') }}</div>
                    <div><strong>Contact:</strong> {{ (note['delivery_contact'] if note and note['delivery_contact'] else '—') }}</div>
                    <div><strong>Tél:</strong> {{ (note['delivery_phone'] if note and note['delivery_phone'] else '—') }}</div>
                    <div><strong>Date:</strong> {{ (note['delivery_date']|format_date if note and note['delivery_date'] else '—') }}</div>
                </div>
            </div>

            <div class="products">
                <div class="products-header"><div class="product-col">Produit</div><div class="qty-col">Qté</div></div>
                {% if note and note['items'] %}
                    {% for item in note['items'] %}
                    <div class="product-row">
                        <div class="product-name">
                            <div>{{ item['product_name'] }}</div>
                            {% if item.get('serials') and item['serials']|length %}
                                <div class="text-muted small">IMEI/Séries: {{ item['serials']|join(', ') }}</div>
                            {% endif %}
                             
                        </div>
                        <div class="product-qty">{{ item['quantity'] }}</div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="product-row"><div class="product-name">Aucun article</div><div class="product-qty"></div></div>
                {% endif %}
            </div>

            <!-- Signature section -->
            {% if signature_data_url %}
            <div style="margin: 14px 24px 0; display:flex; justify-content:flex-end;">
                <div style="min-width:320px; max-width:360px; text-align:center;">
                    <div style="font-size:11px; color:#6b7280; text-transform:uppercase; letter-spacing:.6px; margin-bottom:8px;">Signature</div>
                    <img src="{{ signature_data_url }}" alt="Signature" style="max-width: 350px; max-height: 150px; display:block; margin: 0 auto 6px;" />
                    <div style="border-top:1px solid #d1d5db; width: 360px; margin: 6px auto 0; height: 0;"></div>
                </div>
            </div>
            {% endif %}
            
            <!-- Explication courte sur la section Notes de livraison -->
            <div class="delivery-inline-note" style="margin: 6px 24px 0; font-size: 10px; color: #6b7280; text-align: center;">
                Consignes de réception: vérifiez l’état apparent, l’allumage et les accessoires; comparez quantités et références (IMEI/séries si présents); signalez toute anomalie immédiatement au livreur.
            </div>
  
            <div class="footer">
                <div class="footer-content">
                    <!-- Section Adresse -->
                    <div class="footer-section">
                        <h4>Adresse</h4>
                        <p><i class="fas fa-map-marker-alt"></i> {{ settings.address if settings and settings.address else 'Ouest Foire, Dakar - Sénégal' }}</p>
                        <p><i class="fas fa-envelope"></i> {{ settings.email if settings and settings.email else 'loucarbusinesspro@gmail.com' }}</p>
                    </div>
                    
                    <!-- Section Contact -->
                    <div class="footer-section">
                        <h4>Contact</h4>
                        <p><i class="fas fa-phone"></i> {{ settings.phone if settings and settings.phone else '77 879 7474' }}</p>
                        {% if settings and settings.phone2 %}
                        <p><i class="fas fa-phone"></i> {{ settings.phone2 }}</p>
                        {% endif %}
                        {% if settings and settings.whatsapp %}
                        <p><i class="fab fa-whatsapp"></i> {{ settings.whatsapp }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Section Réseaux sociaux -->
                    <div class="footer-section">
                        <h4>Suivez-nous</h4>
                        {% if settings and settings.instagram %}
                        <p><i class="fab fa-instagram"></i> @{{ settings.instagram }}</p>
                        {% endif %}
                        {% if settings and settings.website %}
                        <p><i class="fas fa-globe"></i> {{ settings.website }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Section Informations légales -->
                    <div class="footer-section">
                        <h4>Informations légales</h4>
                        <p>RC: {{ settings.rc_number if settings and settings.rc_number else 'N/A' }}</p>
                        <p>NINEA: {{ settings.ninea_number if settings and settings.ninea_number else 'N/A' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function(){
            document.getElementById('printBtn')?.addEventListener('click', function(){ window.print(); });
            document.getElementById('returnBtn')?.addEventListener('click', function(){ window.location.href = '/delivery-notes'; });
        };
    </script>
</body>
</html>


